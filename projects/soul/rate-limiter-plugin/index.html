<!doctype html><html><head><title>RateLimiter Plugin · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?a02cb5c75097762223d5a815a03e0a15";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/><img class=logo src=/img/logo/dromara.jpg></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/community/><span>Community</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/projects/soul/rate-limiter-plugin/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/projects/>Projects</a>
<a class=navbar-item href=/guides/>Guides</a>
<a class=navbar-item href=/blog/>Blog</a>
<a class=navbar-item href=/activities/>Activity</a>
<a class=navbar-item href=/community/>Community</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/zh/projects/soul/rate-limiter-plugin/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>RateLimiter Plugin</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/dromara.github.io/edit/master/content/en/projects/soul/rate-limiter-plugin/index.md>Edit</a></div><div class=meta>Update time: 2021-06-23</div></div><article class=typo><h2 id=explanation>Explanation</h2><ul><li><p>rateLimiter is core implementation of gateway restrictions on network traffic.</p></li><li><p>The soul gateway provides a variety of current limiting algorithms, including <code>token bucket algorithm</code>, <code>concurrent token bucket algorithm</code>, <code>leaky bucket algorithm</code> and <code>sliding time window algorithm</code>.</p></li><li><p>The implementation of current limiting algorithm of soul gateway is based on <code>redis</code>.</p></li><li><p>You can set to the interface level or the parameter level. How to use it depends on your traffic configuration.</p></li></ul><h2 id=technical-solution>Technical Solution</h2><h4 id=using-redis-token-bucket-algorithm-to-limit-traffic>Using redis token bucket algorithm to limit traffic.</h4><ul><li>The system generates the token at a constant rate, and then puts the token into the token bucket.</li><li>The token bucket&rsquo;s capacity. When the bucket is full, the token put into it will be discarded.</li><li><p>Each time requests come, you need to obtain a token from the token bucket. If there are tokens, the service will be provided; if there are no tokens, the service will be rejected.</p></li><li><p>Flow Diagram：
<img src=https://yu199195.github.io/images/soul/limiting.png alt></p></li></ul><h4 id=using-redis-leaky-bucket-algorithm-to-limit-traffic>Using redis leaky bucket algorithm to limit traffic.</h4><ul><li><p>water (request) go to the leaky bucket first. The leaky bucket goes out at a fixed speed. When the flow speed is too fast, it will overflow directly (reject service)</p></li><li><p>Flow Diagram：
<img src=/img/soul/plugin/ratelimiter/leakybucket.png alt></p></li></ul><h4 id=using-redis-sliding-time-window-algorithm-to-limit-traffic>Using redis sliding time window algorithm to limit traffic.</h4><ul><li><p>The sliding time window maintains the count value of unit time. Whenever a requests pass, the count value will be increased by 1. When the count value exceeds the preset threshold, other requests in unit time will be rejected. If the unit time has ended, clear the counter to zero and start the next round counting.</p></li><li><p>Flow Diagram：
<img src=/img/soul/plugin/ratelimiter/sldingwindow.png alt></p></li></ul><h2 id=plugin-setting>Plugin Setting</h2><ul><li><p>In <code>soul-admin</code>&ndash;&gt; plugin management&ndash;&gt; <code>rate_limiter</code> set to enable.</p></li><li><p>Configure redis in the plugin.</p></li><li><p>Currently, supporting redis patterns of single, sentinel, and cluster.</p></li><li><p>If it is a sentinel, cluster and other multi-node configuration in URL, please use <code>;</code> for each instance; Division. For example, 192.168.1.1:6379; 192.168.1.2:6379。</p></li><li><p>If the user don&rsquo;t use, please disable the plugin in the background.</p></li></ul><h2 id=plugin-detail>Plugin Detail</h2><ul><li>Introduce <code>rateLimiter</code> dependency in pom.xml file of the gateway.</li></ul><pre><code class=language-xml>  &lt;!-- soul ratelimiter plugin start--&gt;
  &lt;dependency&gt;
      &lt;groupId&gt;org.dromara&lt;/groupId&gt;
      &lt;artifactId&gt;soul-spring-boot-starter-plugin-ratelimiter&lt;/artifactId&gt;
      &lt;version&gt;${last.version}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;!-- soul ratelimiter plugin end--&gt;
</code></pre><ul><li><p>Selectors and rules, please refer to: <a href=../selector-and-rule>selector</a>。</p></li><li><p>Detailed description of the rules</p></li><li><ul><li>Token bucket algorithm/Concurrent token bucket algorithm</li></ul></li></ul><p>lgorithmName：tocketBucket/concurrent</p><p>replenishRate：It is how many requests you allow users to execute per second, while not discarding any requests. This is the filling rate of token bucket.</p><p>burstCapacity：it is the maximum number of requests that users are allowed to execute in one second. This is token bucket can save the number of token.</p><ul><li>* Leaky bucket algorithm</li></ul><p>algorithmName：leakyBucket</p><p>replenishRate：The rate at which requests are executed per unit time, and the rate at which water droplets leak out of the leaky bucket.</p><p>burstCapacity：The maximum number of requests that users are allowed to execute in one second. This is the amount of water in the bucket.</p><ul><li>* Sliding time window algorithm</li></ul><p>algorithmName：sildingWindow</p><p>replenishRate：The rate of requests per unit time, used to calculate the size of the time window.</p><p>burstCapacity：The maximum number of requests in the time window (per unit time).</p></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/dromara>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=https://shenyu.apache.org/zh/projects/shenyu/overview/>ShenYu</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>